extends usercenter_layout
block append scripts
    script.
        var post_content = {};
        var validated=true;
        function checkEmail() {
            re = /(\w*\.*)+@(\w?)+(\.\w{2,})+$/;
            str = $("#email").val();
            if (re.test(str)) {
                $("#email_prompt").html("");
            }
            else {
                $("#email_prompt").html("<font color='red'>格式不正确</font>");
                $("#change_email").disable();
            }
        }
        function validate() {
            if ($("#pw2").val() != $("#pw1").val()) {
                $('#errordiv').show();
                $('#errorMessageSpan').addClass("errorSpan");
                $('#errorMessageSpan').html("<font color='black'>两次密码不一致</font>");
                validated=false;
                return false;
            }
            else{
                validated=true;
                return true;
            }
        }
        $(document).ready(function () {

            $('#phone').val("#{phone}");
            $('#email').val("#{email}");
            $("#submit").click(function () {
                if (validated) {
                    if ($("#phone").val())
                       post_content.phone = $("#phone").val();
                    if ($("#email").val())
                       post_content.email = $("#email").val();
                    if (!$("pre_pw").val()) {
                        post_content.pre_pw = hex_md5($("#pre_pw").val());
                        post_content.new_pw = hex_md5($("#pw2").val());
                    }
                    $.post("/account/manage/info", post_content,
                            function (data, status) {
                                location.replace("/account/manage/info/m/" + data);
                            }
                    );
                }
            });

            if ("#{errorMessage}") {
                $('#errordiv').show();
                $('#errorMessageSpan').addClass("errorSpan");
                $('#errorMessageSpan').html("<font color='black'>#{errorMessage}</font>");
            }
            else {
                $('#errordiv').hide();
            }

            $(".account_info").click(function (){
                $('#errordiv').hide();
            });
            $(".change_info").click(function (){
                $('#errordiv').hide();
            });
        });

block right_block

    .person-right
        .order-remind.g-clear
            span.icon.gi2.gi-order-big
            .meta: h1 个人中心
        ul.nav.nav-tabs(role='tablist')
            li.active(role='presentation')
                a(href='#account_info', role='tab', data-toggle='tab',class='account_info') 账号信息
            li(role='presentation')
                a(href='#change_info', role='tab', data-toggle='tab',class='change_info') 修改信息
        div#errordiv.errordiv
            span(id='errorMessageSpan')
        div.tab-content
            div#account_info.tab-pane.fade.in.active
                .second_block
                    span.second_label 账号信息
                hr#hr_style
                .list_content
                    span(class="list-group-item")  登录名:&nbsp;&nbsp; &nbsp;  #{username}
                    span(class="list-group-item")  真实姓名:&nbsp; #{name}
                    span(class="list-group-item")  电话:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;   #{phone}
                    span(class="list-group-item")  邮箱:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; #{email}
                    span(class="list-group-item")  身份证号: #{sid}
                    span(class="list-group-item")  信用额度: #{credit}
                    span(class="list-group-item")  状态：&nbsp; &nbsp;&nbsp;&nbsp; #{status}

            div#change_info.tab-pane.fade
                .second_block: span.second_label  修改信息
                hr(style='line-width:1;', width='90%', color='#1E90FF', size='1')
                div: form( name='pwinfo_modify_form'): .form-group(style='margin-left:60px')
                    label 原密码
                    input.form-control(type='password', style='width:40%', id='pre_pw',placeholder='不修改密码请勿填写')
                    label 新密码
                    input.form-control(type='password', style='width:40%',id='pw1',placeholder='不修改密码请勿填写')
                    label 确认密码
                    input.form-control(type='password', style='width:40%', id='pw2',placeholder='不修改密码请勿填写',onblur='validate();')
                    span(id='prompt')
                    label(style='display:block') 电话
                    input.form-control(type='text', style='width:40%;display:inline', id='phone')
                    label(style='display:block') 邮箱
                    input.form-control(type='email', style='width:40%;display:inline',onblur='checkEmail();' id='email')
                    span(id='email_prompt',style='margin-left:10px')
                    button.btn.btn-primary(type='button',id='submit',style="display:block") 保存
